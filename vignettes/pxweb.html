<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Mans Magnusson, Leo Lahti et al." />

<meta name="date" content="2021-07-07" />

<title>PX-WEB API Interface for R</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">PX-WEB API Interface for R</h1>
<h4 class="author">Mans Magnusson, Leo Lahti et al.</h4>
<h4 class="date">2021-07-07</h4>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#available-data-sources-and-tools">Available data sources and tools</a></li>
<li><a href="#about-pxweb-apis">About PXWEB APIs</a></li>
</ul></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#installation-issues">Installation issues</a></li>
</ul></li>
<li><a href="#accessing-pxweb-from-r">Accessing PXWEB from R</a></li>
<li><a href="#interactive-use">Interactive use</a></li>
<li><a href="#direct-use">Direct use</a><ul>
<li><a href="#creating-data-queries">Creating data queries</a></li>
<li><a href="#downloading-data">Downloading data</a></li>
<li><a href="#access-data-footnotescomments">Access data footnotes/comments</a></li>
</ul></li>
<li><a href="#citation">Citation</a></li>
<li><a href="#known-issues-and-troubleshooting">Known issues and troubleshooting</a></li>
<li><a href="#licensing">Licensing</a></li>
<li><a href="#session-info">Session info</a></li>
</ul>
</div>

<p>This R package provides tools to access <a href="https://pxnet2.stat.fi/API-description_SCB.pdf">PX-WEB API</a>. Your <a href="http://ropengov.org/community/">contributions</a> and <a href="https://github.com/ropengov/pxweb">bug reports and other feedback</a> are welcome!</p>
<p>More information on the PX-Web/PC-Axis API can be found <a href="https://www.scb.se/en/services/statistical-programs-for-px-files/px-web/">here</a>.</p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>PXWEB is an API structure developed by Statistics Sweden together with other national statistical institutions (NSI) to disseminate public statistics in a structured way. This enables downloading and usage of data from statistical agencies without using a web browser direct over HTTP/HTTPS.</p>
<p>The <code>pxweb</code> R package connects any PXWEB API to R and hence facilitate the access, use and referencing of data from PXWEB APIs.</p>
<div id="available-data-sources-and-tools" class="section level3">
<h3>Available data sources and tools</h3>
<p><a href="https://www.scb.se/en/services/statistical-programs-for-px-files/px-web/pxweb-examples/">A number of organizations</a> use PXWEB to distribute hierarchical data. You can browse the available data sets at:</p>
<ul>
<li><a href="http://www.statistikdatabasen.scb.se/pxweb/en/ssd/">Statistics Sweden</a> with <a href="https://pxnet2.stat.fi/API-description_SCB.pdf">API Description</a></li>
<li><a href="https://tilastokeskus.fi/til/aihealuejako.html">Statistics Finland</a> <a href="https://pxnet2.stat.fi/api1.html">StatFi API Description</a></li>
<li><a href="https://www.scb.se/en/services/statistical-programs-for-px-files/px-web/pxweb-examples/">Other organizations using PX-WEB</a></li>
</ul>
</div>
<div id="about-pxweb-apis" class="section level3">
<h3>About PXWEB APIs</h3>
<p>The data in PXWEB APIs consists of a metadata part and a data part. Metadata is structured in a hierarchical node tree, where each node contains information about subnodes that are below it in the tree or, if the nodes are at the bottom of the tree structure, the data referenced by the node as well as what dimensions are available for the data at that subnode.</p>
</div>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>To install the latest stable release version from CRAN, just use:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;pxweb&quot;</span>)</span></code></pre></div>
<p>To install the latest stable release version from GitHub, just use:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ropengov/pxweb&quot;</span>)</span></code></pre></div>
<p>Test the installation by loading the library:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(pxweb)</span></code></pre></div>
<p>A tutorial is included with the package with:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">vignette</span>(<span class="dt">topic=</span><span class="st">&quot;pxweb&quot;</span>)</span></code></pre></div>
<div id="installation-issues" class="section level3">
<h3>Installation issues</h3>
<p>We also recommend setting the UTF-8 encoding since each individual API may have local specificl letters:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">Sys.setlocale</span>(<span class="dt">locale=</span><span class="st">&quot;UTF-8&quot;</span>) </span></code></pre></div>
</div>
</div>
<div id="accessing-pxweb-from-r" class="section level2">
<h2>Accessing PXWEB from R</h2>
<p>There are two ways of using the <code>pxweb</code> R package to access data, either interactively of using the core functions. To access data, two parts are needed, an URL to the data table in the API and a query specifying what data is of interest.</p>
</div>
<div id="interactive-use" class="section level2">
<h2>Interactive use</h2>
<p>The simplest way of using <code>pxweb</code> is to use it interactively and navigate the API to the data of interest and then set up the data query of interest.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Navigate through all pxweb api:s in the R package API catalogue</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>d &lt;-<span class="st"> </span><span class="kw">pxweb_interactive</span>()</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Get data from SCB (Statistics Sweden)</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>d &lt;-<span class="st"> </span><span class="kw">pxweb_interactive</span>(<span class="st">&quot;api.scb.se&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># Fetching data from statfi (Statistics Finland)</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>d &lt;-<span class="st"> </span><span class="kw">pxweb_interactive</span>(<span class="st">&quot;pxnet2.stat.fi&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co"># Fetching data from StatBank (Statistics Norway)</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>d &lt;-<span class="st"> </span><span class="kw">pxweb_interactive</span>(<span class="st">&quot;data.ssb.no&quot;</span>)</span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co"># To see all available PXWEB APIs use</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>pxweb_apis &lt;-<span class="st"> </span><span class="kw">pxweb_api_catalogue</span>()</span></code></pre></div>
<p>In the example above we use the interactive functionality from the PXWEB API root, but we could use any path to the API.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Start with a specific path.</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>d &lt;-<span class="st"> </span><span class="kw">pxweb_interactive</span>(<span class="st">&quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A&quot;</span>)</span></code></pre></div>
<p>This also means that we can navigate any PXWEB API, irrespectively of if they are a part of the R package API catalog or not. Just supply an URL to somewhere in the API and then navigate the API from there.</p>
<p>Due to new CRAN policies, it is not possible to use an R function to edit the api catalogue of the R package, but editing the can be done easily from R using <code>file.edit()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">file.edit</span>(<span class="kw">pxweb_api_catalogue_path</span>())</span></code></pre></div>
<p>Although, if the <code>pxweb</code> is installed again, it will overwrite the old api catalogue. So the easiest way is to do add a PXWEB API to the global catalogue. To do this, just do a pull request at the pxweb GitHub page <a href="https://github.com/rOpenGov/pxweb">here</a>.</p>
</div>
<div id="direct-use" class="section level2">
<h2>Direct use</h2>
<p>Under the hood, the pxweb package uses the <code>pxweb_get()</code> function to access data from the PXWEB API. It also keeps track of the time limits of the API and split up to big queries into optimal downloadable chunks. If we use <code>pxweb_get()</code> without a query, the function either returns a PXWEB LEVELS object or a PXWEB METADATA object, depending if the URL points to a table in the API or not. Here is an example of a PXWEB LEVELS object.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Get PXWEB levels</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>px_levels &lt;-<span class="st"> </span><span class="kw">pxweb_get</span>(<span class="st">&quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>px_levels</span></code></pre></div>
<pre><code>## PXWEB LEVELS
##   BefolkningNy (t): Population by region, marital status, age and sex.  Year 1968 - 2020
##   FolkmangdNov (t): Population 1 November by region, age and sex. Year 2002 - 2020
##   FolkmangdDistrikt (t): Population by district, Landscape or Part of the country by sex. Year 2015 - 2020
##   BefolkManad (t): Population per month by region, age and sex. Year 2000M01 - 2021M05
##   BefolkningR1860N (t): Population by age and sex. Year 1860 - 2020</code></pre>
<p>And if we use <code>pxweb_get()</code> for a table, a PXWEB METADATA object is returned.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Get PXWEB metadata about a table</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>px_meta &lt;-<span class="st"> </span><span class="kw">pxweb_get</span>(<span class="st">&quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a>px_meta</span></code></pre></div>
<pre><code>## PXWEB METADATA
## Population by region, marital status, age, sex, observations and year 
## variables:
##  [[1]] Region: region
##  [[2]] Civilstand: marital status
##  [[3]] Alder: age
##  [[4]] Kon: sex
##  [[5]] ContentsCode: observations
##  [[6]] Tid: year</code></pre>
<div id="creating-data-queries" class="section level3">
<h3>Creating data queries</h3>
<p>To download data we need both the URL to the table and a query specifying what parts of the table are of interest. An URL to a table is an URL that will return a metadata object if not a query is supplied. Creating a query can be done in three main ways. The first and simplest approach is to use <code>pxweb_interactive()</code> to explore the table URL and create a query interactively.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>d &lt;-<span class="st"> </span><span class="kw">pxweb_interactive</span>(<span class="st">&quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy&quot;</span>)</span></code></pre></div>
<p>The interactive function will return the query and the url, even if the data is not downloaded.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>d<span class="op">$</span>url</span></code></pre></div>
<pre><code>## [1] &quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>d<span class="op">$</span>query</span></code></pre></div>
<pre><code>## PXWEB QUERY
## query:
##  [[1]] Region (item):
##    00
##  [[2]] Civilstand (item):
##    OG, G, ÄNKL, SK
##  [[3]] Alder (item):
##    tot
##  [[4]] ContentsCode (item):
##    BE0101N1
##  [[5]] Tid (item):
##    2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017</code></pre>
<p>We can also turn the query to a json query that can be used outside R.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">pxweb_query_as_json</span>(d<span class="op">$</span>query, <span class="dt">pretty =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## {
##   &quot;query&quot;: [
##     {
##       &quot;code&quot;: &quot;Region&quot;,
##       &quot;selection&quot;: {
##         &quot;filter&quot;: &quot;item&quot;,
##         &quot;values&quot;: [&quot;00&quot;]
##       }
##     },
##     {
##       &quot;code&quot;: &quot;Civilstand&quot;,
##       &quot;selection&quot;: {
##         &quot;filter&quot;: &quot;item&quot;,
##         &quot;values&quot;: [&quot;OG&quot;, &quot;G&quot;, &quot;ÄNKL&quot;, &quot;SK&quot;]
##       }
##     },
##     {
##       &quot;code&quot;: &quot;Alder&quot;,
##       &quot;selection&quot;: {
##         &quot;filter&quot;: &quot;item&quot;,
##         &quot;values&quot;: [&quot;tot&quot;]
##       }
##     },
##     {
##       &quot;code&quot;: &quot;ContentsCode&quot;,
##       &quot;selection&quot;: {
##         &quot;filter&quot;: &quot;item&quot;,
##         &quot;values&quot;: [&quot;BE0101N1&quot;]
##       }
##     },
##     {
##       &quot;code&quot;: &quot;Tid&quot;,
##       &quot;selection&quot;: {
##         &quot;filter&quot;: &quot;item&quot;,
##         &quot;values&quot;: [&quot;2010&quot;, &quot;2011&quot;, &quot;2012&quot;, &quot;2013&quot;, &quot;2014&quot;, &quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;]
##       }
##     }
##   ],
##   &quot;response&quot;: {
##     &quot;format&quot;: &quot;json&quot;
##   }
## }</code></pre>
<p>The second approach is to specify the query either as an R list or a JSON object. Some Statistical Agencies, such as Statistics Sweden, supply queries directly as a JSON object on their web pages. These queries can be used directly. Below is another example of a JSON query for the table above. For details on how to set up a JSON query, see the PXWEB API documentation.</p>
<pre><code>{
  &quot;query&quot;: [
    {
      &quot;code&quot;: &quot;Civilstand&quot;,
      &quot;selection&quot;: {
        &quot;filter&quot;: &quot;item&quot;,
        &quot;values&quot;: [&quot;OG&quot;, &quot;G&quot;, &quot;ÄNKL&quot;, &quot;SK&quot;]
      }
    },
    {
      &quot;code&quot;: &quot;Kon&quot;,
      &quot;selection&quot;: {
        &quot;filter&quot;: &quot;item&quot;,
        &quot;values&quot;: [&quot;1&quot;, &quot;2&quot;]
      }
    },
    {
      &quot;code&quot;: &quot;ContentsCode&quot;,
      &quot;selection&quot;: {
        &quot;filter&quot;: &quot;item&quot;,
        &quot;values&quot;: [&quot;BE0101N1&quot;]
      }
    },
    {
      &quot;code&quot;: &quot;Tid&quot;,
      &quot;selection&quot;: {
        &quot;filter&quot;: &quot;item&quot;,
        &quot;values&quot;: [&quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;]
      }
    }
  ],
  &quot;response&quot;: {
    &quot;format&quot;: &quot;json&quot;
  }
} </code></pre>
<p>To use this JSON query we just store the JSON query as a file and supply the path to the file to the <code>pxweb_query()</code> function.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>pxq &lt;-<span class="st"> </span><span class="kw">pxweb_query</span>(<span class="st">&quot;path/to/the/json/query.json&quot;</span>)</span></code></pre></div>
<p>Finally, we can create a PXWEB query from an R list where each list element is a variable and selected observation.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>pxweb_query_list &lt;-<span class="st"> </span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">list</span>(<span class="st">&quot;Civilstand&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;*&quot;</span>), <span class="co"># Use &quot;*&quot; to select all</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>       <span class="st">&quot;Kon&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>),</span>
<span id="cb22-4"><a href="#cb22-4"></a>       <span class="st">&quot;ContentsCode&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;BE0101N1&quot;</span>),</span>
<span id="cb22-5"><a href="#cb22-5"></a>       <span class="st">&quot;Tid&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;2015&quot;</span>,<span class="st">&quot;2016&quot;</span>,<span class="st">&quot;2017&quot;</span>))</span>
<span id="cb22-6"><a href="#cb22-6"></a>pxq &lt;-<span class="st"> </span><span class="kw">pxweb_query</span>(pxweb_query_list)</span>
<span id="cb22-7"><a href="#cb22-7"></a>pxq</span></code></pre></div>
<pre><code>## PXWEB QUERY
## query:
##  [[1]] Civilstand (all):
##    *
##  [[2]] Kon (item):
##    1, 2
##  [[3]] ContentsCode (item):
##    BE0101N1
##  [[4]] Tid (item):
##    2015, 2016, 2017</code></pre>
<p>The query can be validated against the metadata object to asses that the query can be used. This is done automatically when the data is fetched with <code>pxweb_get()</code>, but can also be done manually.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">pxweb_validate_query_with_metadata</span>(pxq, px_meta)</span></code></pre></div>
</div>
<div id="downloading-data" class="section level3">
<h3>Downloading data</h3>
<p>When we have the URL to a data table and a query we can simply download the data with <code>pxweb_get()</code>. The function returns a <code>pxweb_data</code> object that contains the downloaded data.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>pxd &lt;-<span class="st"> </span><span class="kw">pxweb_get</span>(<span class="st">&quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy&quot;</span>,</span>
<span id="cb25-2"><a href="#cb25-2"></a>                 pxq)</span>
<span id="cb25-3"><a href="#cb25-3"></a>pxd</span></code></pre></div>
<pre><code>## PXWEB DATA
## With 4 variables and 24 observations.</code></pre>
<p>If we instead want a JSON-stat object, we just change the response format to JSON-stat and we will get a JSON-stat object returned. Only JSON and JSON-stat formats are implemented in the PXWEB API.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>pxq<span class="op">$</span>response<span class="op">$</span>format &lt;-<span class="st"> &quot;json-stat&quot;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>pxjstat &lt;-<span class="st"> </span><span class="kw">pxweb_get</span>(<span class="st">&quot;http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy&quot;</span>,</span>
<span id="cb27-3"><a href="#cb27-3"></a>                     pxq)</span>
<span id="cb27-4"><a href="#cb27-4"></a>pxjstat</span></code></pre></div>
<pre><code>## {
##   &quot;dataset&quot;: {
##     &quot;dimension&quot;: {
##       &quot;Civilstand&quot;: {
##         &quot;label&quot;: [&quot;marital status&quot;],
##         &quot;category&quot;: {
##           &quot;index&quot;: {
##             &quot;OG&quot;: [0],
##             &quot;G&quot;: [1],
##             &quot;ÄNKL&quot;: [2],
##             &quot;SK&quot;: [3]
##           },
##           &quot;label&quot;: {
##             &quot;OG&quot;: [&quot;single&quot;],
##             &quot;G&quot;: [&quot;married&quot;],
##             &quot;ÄNKL&quot;: [&quot;widowers/widows&quot;],
##             &quot;SK&quot;: [&quot;divorced&quot;]
##           }
##         }
##       },
##       &quot;Kon&quot;: {
##         &quot;label&quot;: [&quot;sex&quot;],
##         &quot;category&quot;: {
##           &quot;index&quot;: {
##             &quot;1&quot;: [0],
##             &quot;2&quot;: [1]
##           },
##           &quot;label&quot;: {
##             &quot;1&quot;: [&quot;men&quot;],
##             &quot;2&quot;: [&quot;women&quot;]
##           }
##         },
##         &quot;link&quot;: {
##           &quot;describedby&quot;: [
##             {
##               &quot;extension&quot;: {
##                 &quot;Kon&quot;: [&quot;Kön&quot;]
##               }
##             }
##           ]
##         }
##       },
##       &quot;ContentsCode&quot;: {
##         &quot;label&quot;: [&quot;observations&quot;],
##         &quot;category&quot;: {
##           &quot;index&quot;: {
##             &quot;BE0101N1&quot;: [0]
##           },
##           &quot;label&quot;: {
##             &quot;BE0101N1&quot;: [&quot;Population&quot;]
##           },
##           &quot;unit&quot;: {
##             &quot;BE0101N1&quot;: {
##               &quot;base&quot;: [&quot;number&quot;],
##               &quot;decimals&quot;: [0]
##             }
##           }
##         }
##       },
##       &quot;Tid&quot;: {
##         &quot;label&quot;: [&quot;year&quot;],
##         &quot;category&quot;: {
##           &quot;index&quot;: {
##             &quot;2015&quot;: [0],
##             &quot;2016&quot;: [1],
##             &quot;2017&quot;: [2]
##           },
##           &quot;label&quot;: {
##             &quot;2015&quot;: [&quot;2015&quot;],
##             &quot;2016&quot;: [&quot;2016&quot;],
##             &quot;2017&quot;: [&quot;2017&quot;]
##           }
##         }
##       },
##       &quot;id&quot;: [
##         [&quot;Civilstand&quot;],
##         [&quot;Kon&quot;],
##         [&quot;ContentsCode&quot;],
##         [&quot;Tid&quot;]
##       ],
##       &quot;size&quot;: [
##         [4],
##         [2],
##         [1],
##         [3]
##       ],
##       &quot;role&quot;: {
##         &quot;metric&quot;: [
##           [&quot;ContentsCode&quot;]
##         ],
##         &quot;time&quot;: [
##           [&quot;Tid&quot;]
##         ]
##       }
##     },
##     &quot;label&quot;: [&quot;Population by marital status, sex, observations and year&quot;],
##     &quot;source&quot;: [&quot;Statistics Sweden&quot;],
##     &quot;updated&quot;: [&quot;2021-07-07T18:01:00Z&quot;],
##     &quot;value&quot;: [
##       [2762601],
##       [2820248],
##       [2870477],
##       [2394842],
##       [2437315],
##       [2477012],
##       [1651482],
##       [1672460],
##       [1687016],
##       [1639519],
##       [1657129],
##       [1671381],
##       [99751],
##       [99654],
##       [99682],
##       [345008],
##       [340709],
##       [335961],
##       [417132],
##       [420985],
##       [425487],
##       [540682],
##       [546653],
##       [553226]
##     ],
##     &quot;extension&quot;: {
##       &quot;px&quot;: {
##         &quot;infofile&quot;: [&quot;BE0101&quot;],
##         &quot;tableid&quot;: [&quot;TAB638&quot;],
##         &quot;decimals&quot;: [0]
##       }
##     }
##   }
## }</code></pre>
<p>If the queries are large (contain more values than the PXWEB API maximum allowed values), the query is chunked into optimal chunks and is then downloaded sequentially. PXWEB data objects are then combined to one large PXWEB data object, while JSON-stat objects are returned as a list of JSON-stat objects.</p>
<p>For more advanced connections to the API, the <code>pxweb_advanced_get()</code> gives the flexibility to access the underlying HTTP calls using <code>httr</code> as well as logging the HTTP calls for debugging.</p>
<p>The downloaded PXWEB data objects can then be converted to either <code>data.frame</code>s or to a character matrix. The character matrix contains the “raw” data while the data.frame returns a data.frame for analysis in a tidy format. This means that missing values (such as “..” are converted to <code>NA</code>) in a data.frame. Using the arguments <code>variable.value.type</code> and <code>column.name.type</code> we can also choose if we want the code or the text column names and value types.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>pxdf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(pxd, <span class="dt">column.name.type =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">variable.value.type =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">head</span>(pxdf)</span></code></pre></div>
<pre><code>##   marital status   sex year Population
## 1         single   men 2015    2762601
## 2         single   men 2016    2820248
## 3         single   men 2017    2870477
## 4         single women 2015    2394842
## 5         single women 2016    2437315
## 6         single women 2017    2477012</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>pxdf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(pxd, <span class="dt">column.name.type =</span> <span class="st">&quot;code&quot;</span>, <span class="dt">variable.value.type =</span> <span class="st">&quot;code&quot;</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">head</span>(pxdf)</span></code></pre></div>
<pre><code>##   Civilstand Kon  Tid BE0101N1
## 1         OG   1 2015  2762601
## 2         OG   1 2016  2820248
## 3         OG   1 2017  2870477
## 4         OG   2 2015  2394842
## 5         OG   2 2016  2437315
## 6         OG   2 2017  2477012</code></pre>
<p>In a similar way, we can access the raw data as a character matrix with <code>as.matrix</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>pxmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(pxd, <span class="dt">column.name.type =</span> <span class="st">&quot;code&quot;</span>, <span class="dt">variable.value.type =</span> <span class="st">&quot;code&quot;</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="kw">head</span>(pxmat)</span></code></pre></div>
<pre><code>##      Civilstand Kon Tid    BE0101N1 
## [1,] &quot;OG&quot;       &quot;1&quot; &quot;2015&quot; &quot;2762601&quot;
## [2,] &quot;OG&quot;       &quot;1&quot; &quot;2016&quot; &quot;2820248&quot;
## [3,] &quot;OG&quot;       &quot;1&quot; &quot;2017&quot; &quot;2870477&quot;
## [4,] &quot;OG&quot;       &quot;2&quot; &quot;2015&quot; &quot;2394842&quot;
## [5,] &quot;OG&quot;       &quot;2&quot; &quot;2016&quot; &quot;2437315&quot;
## [6,] &quot;OG&quot;       &quot;2&quot; &quot;2017&quot; &quot;2477012&quot;</code></pre>
</div>
<div id="access-data-footnotescomments" class="section level3">
<h3>Access data footnotes/comments</h3>
<p>In addition to the data, the PXWEB DATA object may also contain comments for the data. This can be accessed using <code>pxweb_data_comments()</code> function.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>pxdc &lt;-<span class="st"> </span><span class="kw">pxweb_data_comments</span>(pxd)</span>
<span id="cb35-2"><a href="#cb35-2"></a>pxdc</span></code></pre></div>
<pre><code>## NO PXWEB DATA COMMENTS</code></pre>
<p>In this case, we did not have any comments. If we have comments we can turn the comments into a data.frame with one comment per row.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">as.data.frame</span>(pxdc)</span></code></pre></div>
</div>
</div>
<div id="citation" class="section level2">
<h2>Citation</h2>
<p>Finally, if we use the data, we can easily create a citation for a <code>pxweb_data</code> object using the <code>pxweb_cite()</code> function. For full reproducibility, please also cite the package.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">pxweb_cite</span>(pxd)</span></code></pre></div>
<pre><code>## 
## Statistics Sweden (2021). &quot;Population by region, marital status, age,
## sex, observations and year.&quot; [Data accessed 2021-07-07 20:01:45 using
## pxweb R package 0.11.0], &lt;URL:
## http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy&gt;.
## 
## A BibTeX entry for LaTeX users is
## 
##   @Misc{,
##     title = {Population by region, marital status, age, sex, observations and year},
##     author = {{Statistics Sweden}},
##     organization = {Statistics Sweden},
##     address = {Stockholm, Sweden},
##     year = {2021},
##     url = {http://api.scb.se/OV0104/v1/doris/en/ssd/BE/BE0101/BE0101A/BefolkningNy},
##     note = {[Data accessed 2021-07-07 20:01:45 using pxweb R package 0.11.0]},
##   }
## 
## 
## Kindly cite the pxweb R package as follows:
## 
##   Mans Magnusson, Markus Kainu, Janne Huovari, and Leo Lahti
##   (rOpenGov).  pxweb: R tools for PXWEB API.  URL:
##   http://github.com/ropengov/pxweb
## 
## A BibTeX entry for LaTeX users is
## 
##   @Misc{,
##     title = {pxweb: R tools for PX-WEB API},
##     author = {Mans Magnusson and Markus Kainu and Janne Huovari and Leo Lahti},
##     year = {2019},
##   }</code></pre>
</div>
<div id="known-issues-and-troubleshooting" class="section level2">
<h2>Known issues and troubleshooting</h2>
<p>See <a href="https://github.com/rOpenGov/pxweb/blob/master/TROUBLESHOOTING.md">TROUBLESHOOTING.md</a> for a list of current known issues.</p>
</div>
<div id="licensing" class="section level2">
<h2>Licensing</h2>
<p>This work can be freely used, modified and distributed under the open license specified in the <a href="https://github.com/rOpenGov/pxweb/blob/master/DESCRIPTION">DESCRIPTION file</a>.</p>
</div>
<div id="session-info" class="section level2">
<h2>Session info</h2>
<p>This vignette was created with</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] C/sv_SE.UTF-8/sv_SE.UTF-8/C/sv_SE.UTF-8/sv_SE.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] pxweb_0.11.0
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.6           compiler_4.0.2       prettyunits_1.1.1   
##  [4] remotes_2.2.0.9000   tools_4.0.2          testthat_2.99.0.9000
##  [7] digest_0.6.27        pkgbuild_1.2.0       pkgload_1.1.0       
## [10] jsonlite_1.7.2       memoise_1.1.0        evaluate_0.14       
## [13] lifecycle_1.0.0      checkmate_2.0.0      rlang_0.4.10        
## [16] cli_2.5.0            rstudioapi_0.13      curl_4.3.2          
## [19] yaml_2.2.1           xfun_0.17            withr_2.4.0         
## [22] stringr_1.4.0        httr_1.4.2           roxygen2_7.1.1      
## [25] knitr_1.29           xml2_1.3.2           desc_1.2.0          
## [28] fs_1.5.0             devtools_2.3.1       rprojroot_2.0.2     
## [31] glue_1.4.2           R6_2.5.0             processx_3.5.2      
## [34] rmarkdown_2.3        sessioninfo_1.1.1    callr_3.7.0         
## [37] purrr_0.3.4          magrittr_2.0.1       htmltools_0.5.0     
## [40] backports_1.2.1      ps_1.5.0             ellipsis_0.3.2      
## [43] usethis_2.0.1        assertthat_0.2.1     stringi_1.5.3       
## [46] crayon_1.4.1</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
