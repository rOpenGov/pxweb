<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Troubleshooting pxweb R package • pxweb</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="deps/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Troubleshooting pxweb R package"><meta property="og:image" content="https://ropengov.github.io/pxweb/logo.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@rOpenGov"><meta name="twitter:site" content="@rOpenGov"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet"><!-- rogtemplate style sheet --><link href="BS5/rogtemplate.css" rel="stylesheet"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">pxweb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.13.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="articles/pxweb.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rOpenGov/pxweb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Troubleshooting pxweb R package</h1>
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/pxweb/blob/HEAD/TROUBLESHOOTING.md" class="external-link"><code>TROUBLESHOOTING.md</code></a></small>
    </div>

<div id="troubleshooting-pxweb-r-package" class="section level1">

<div class="section level2">
<h2 id="encoding-errors-on-windows">Encoding errors on Windows<a class="anchor" aria-label="anchor" href="#encoding-errors-on-windows"></a></h2>
<div class="section level3">
<h3 id="date-added">Date added:<a class="anchor" aria-label="anchor" href="#date-added"></a></h3>
<p>2021-07-07</p>
</div>
<div class="section level3">
<h3 id="versions">Versions<a class="anchor" aria-label="anchor" href="#versions"></a></h3>
<p>This problem exist in pxweb version 0.10 +. This is only a problem on Windows.</p>
</div>
<div class="section level3">
<h3 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a></h3>
<p>On windows, some letters are not encoded correctly. For example, in R or Rstudio the UTF-8 coding is not preserved during assignment. For instance:</p>
<pre><code>x &lt;- "ČETRTLETJE"
x
[1] "CETRTLETJE"</code></pre>
<p>This means that when a UTF-8 encoding is used in a query explicitly, the package will not find the variable name and hence will return something like:</p>
<pre><code>Assertion on 'pxweb_query_variable_code' failed: Must be element of set {'KOHEZIJSKA REGIJA','DRŽAVA ROJSTVA','SPOL','CETRTLETJE','MERITVE'}, but is 'CETRTLETJE'.</code></pre>
</div>
<div class="section level3">
<h3 id="workaround">Workaround<a class="anchor" aria-label="anchor" href="#workaround"></a></h3>
<p>To fix this, explicitly referenced the offending character using the escape sequence as:</p>
<pre><code><span class="va">pxweb_query_list</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"KOHEZIJSKA REGIJA"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">)</span>,
       <span class="st">"DRŽAVA ROJSTVA"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">)</span>,
       <span class="st">"SPOL"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">)</span>,
       <span class="st">"MERITVE"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2000"</span><span class="op">)</span><span class="op">)</span>
       
<span class="co"># Explicit encoding ČETRTLETJE</span>
<span class="va">fixed_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"\U010C"</span>, <span class="st">"ETRTLETJE"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2008Q1"</span>,<span class="st">"2008Q2"</span><span class="op">)</span>
<span class="va">pxweb_query_list</span><span class="op">[[</span><span class="va">fixed_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">years</span>

<span class="va">pxdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pxweb_get.html">pxweb_get</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">pxweb_query_list</span><span class="op">)</span></code></pre>
<p>To find the specific encoding for your special letter, see: <a href="https://www.fileformat.info/info/unicode/char/search.htm" class="external-link uri">https://www.fileformat.info/info/unicode/char/search.htm</a></p>
</div>
<div class="section level3">
<h3 id="more-info">More info<a class="anchor" aria-label="anchor" href="#more-info"></a></h3>
<p><a href="https://github.com/rOpenGov/pxweb/issues/217" class="external-link uri">https://github.com/rOpenGov/pxweb/issues/217</a></p>
</div>
</div>
<div class="section level2">
<h2 id="error-running-pxweb-in-parallel">Error: Running pxweb in parallel<a class="anchor" aria-label="anchor" href="#error-running-pxweb-in-parallel"></a></h2>
<div class="section level3">
<h3 id="date-added-1">Date added:<a class="anchor" aria-label="anchor" href="#date-added-1"></a></h3>
<p>2021-07-07</p>
</div>
<div class="section level3">
<h3 id="versions-1">Versions<a class="anchor" aria-label="anchor" href="#versions-1"></a></h3>
<p>This problem exist in pxweb version 0.8+.</p>
</div>
<div class="section level3">
<h3 id="description-1">Description<a class="anchor" aria-label="anchor" href="#description-1"></a></h3>
<p>Currently, the <code>pxweb</code> package is not thread-safe, and hence it is not safe to runt multiple <code>pxweb_get</code> functions in parallel or in different R sessions from the same computer/IP address.</p>
</div>
<div class="section level3">
<h3 id="workaround-1">Workaround<a class="anchor" aria-label="anchor" href="#workaround-1"></a></h3>
<p>Don’t run pxweb in parallel.</p>
</div>
</div>
<div class="section level2">
<h2 id="error-too-large-query">Error: Too large query<a class="anchor" aria-label="anchor" href="#error-too-large-query"></a></h2>
<div class="section level3">
<h3 id="date-added-2">Date added:<a class="anchor" aria-label="anchor" href="#date-added-2"></a></h3>
<p>2019-02-15</p>
</div>
<div class="section level3">
<h3 id="versions-2">Versions<a class="anchor" aria-label="anchor" href="#versions-2"></a></h3>
<p>This problem exist in pxweb version 0.8+.</p>
</div>
<div class="section level3">
<h3 id="description-2">Description<a class="anchor" aria-label="anchor" href="#description-2"></a></h3>
<p>In some situation (some PXWEB APIS) it is possible to get an <code>Error: Too large query</code> error message (can look a little bit different for different pxweb versions) if a large query is done. The reason for this problem is that the pxweb R package cannot split the query into chunks/batches with a size smaller than the maximum values limit for the API.</p>
<p>All PXWEB APIs table objects have dimension and/or content variables. Content variables are only one variable and indicate what contents to download (such as the number of inhabitants and the percentage change in inhabitants). It is not always so that content variables exist in a PXWEB table. To split up a large query, only dimension variables can be split into smaller chunks (they are the rows in the PX-DATA object). So the pxweb R package tries to identify what variables that are dimension variables by checking if the variable can be eliminated or if the variable is the time variable. So if a variable is not time and cannot be eliminated it is not possible to be sure that the variable is not a content variable, and then the variable cannot be used to split the query.</p>
<p>This will hopefully be solved by the PXWEB API provider supplying information if the variable is a content variable or not in future releases.</p>
</div>
<div class="section level3">
<h3 id="workaround-2">Workaround<a class="anchor" aria-label="anchor" href="#workaround-2"></a></h3>
<p>The only way to solve this currently is to manually specify variables that the pxweb package can use to split up the query by setting the variables elimination to <code>TRUE</code> that are not content variables. Below is a working example of a workaround.</p>
<pre><code>url &lt;- "http://px.hagstofa.is/pxis/api/v1/is/Efnahagur/utanrikisverslun/1_voruvidskipti/03_inntollskra/UTA03801.px"
pxweb_query_list &lt;- list("Tollskrárnúmer" = c("*"),
                         "Land" = c("AF", "AL"),           
                         "Mánuður" = c("2016M01"),
                         "Eining" = c("*"))
pxq &lt;- pxweb_query(pxweb_query_list)
px_data &lt;- pxweb_get(url, pxq)
Error: Too large query

# Variable(s) Tollskrárnúmer, Eining cannot be split to batches (eliminate is FALSE).

# We download the metadata object and set eliminate to TRUE 
# (since Eining is not a content variable)
pxmd &lt;- pxweb_get(url)
pxmd$variables[[4]]$elimination &lt;- TRUE

# We explicitly supply the meta data object to use for downloading
px_data &lt;- pxweb_advanced_get(url, pxq, pxmdo = pxmd)

Downloading large query (in 4 batches):
  |==================================================================| 100%

px_data

PXWEB DATA
With 5 variables and 35792 observations.</code></pre>
<p>Another example is:</p>
<pre><code><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rOpenGov/pxweb/" class="external-link">pxweb</a></span><span class="op">)</span>
<span class="va">pxweb_query_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Typ av psykisk hälsa"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span>,
                         <span class="st">"Andel och konfidensintervall"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span>,
                         <span class="st">"Ålder"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"16-29"</span>,<span class="st">"30-44"</span>,<span class="st">"45-64"</span>,<span class="st">"65-84"</span><span class="op">)</span>,
                         <span class="st">"Kön"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span><span class="op">)</span>,
                         <span class="st">"År"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2018"</span>,<span class="st">"2016"</span>,<span class="st">"2015"</span>,
                                <span class="st">"2014"</span>,<span class="st">"2013"</span>,<span class="st">"2012"</span>,
                                <span class="st">"2011"</span>,<span class="st">"2010"</span>,<span class="st">"2009"</span>,
                                <span class="st">"2008"</span>,<span class="st">"2007"</span>,<span class="st">"2006"</span>,
                                <span class="st">"2005"</span>,<span class="st">"2004"</span><span class="op">)</span><span class="op">)</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"http://fohm-app.folkhalsomyndigheten.se/Folkhalsodata/api/v1/sv/B_HLV/dPsykhals/HLV_Psykisk_halsa_alder.px"</span>

<span class="co"># We get the error that no variables can be split up. </span>
<span class="va">px_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pxweb_get.html">pxweb_get</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>,
                     query <span class="op">=</span> <span class="va">pxweb_query_list</span><span class="op">)</span>

<span class="co"># We download the metadata object and set eliminate to TRUE for </span>
<span class="co"># one variable that is not a content variable.</span>
<span class="co"># Here variable 1 ('Typ av psykisk hälsa') is a variable we can </span>
<span class="co"># split the batches on since (we know) it is not a content variable.</span>
<span class="va">pxmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pxweb_get.html">pxweb_get</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>
<span class="va">pxmd</span><span class="op">$</span><span class="va">variables</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">elimination</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># We explicitly supply the meta data object to use for downloading</span>
<span class="va">px_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pxweb_advanced_get.html">pxweb_advanced_get</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">pxweb_query_list</span>, pxmdo <span class="op">=</span> <span class="va">pxmd</span><span class="op">)</span>

<span class="co">##   Downloading large query (in 2 batches):</span>
<span class="co">## |========================================================| 100%</span>

<span class="va">px_data</span>

<span class="co">## PXWEB DATA</span>
<span class="co">## With 6 variables and 1792 observations.</span></code></pre>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Mans Magnusson, Markus Kainu, Janne Huovari, Leo Lahti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

    <!-- Add ropengov logo -->
  <script src="BS5/logo.js"></script></body></html>

